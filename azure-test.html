// è¿è¡Œå®Œæ•´è¯Šæ–­
        async function runFullDiagnostic() {
            diagnosticLogs = [];
            log('å¼€å§‹å®Œæ•´è¯Šæ–­æµç¨‹');
            
            showResult('diagnosticResult', 'ğŸš€ æ­£åœ¨è¿è¡Œå®Œæ•´è¯Šæ–­...\nè¯·ç¨ç­‰...', 'info');

            try {
                // 1. é…ç½®æ£€æŸ¥
                log('æ­¥éª¤ 1: æ£€æŸ¥é…ç½®');
                const config = getCurrentConfig();
                
                // 2. Netlifyå‡½æ•°æµ‹è¯•
                log('æ­¥éª¤ 2: æµ‹è¯•Netlifyå‡½æ•°');
                await testNetlifyConfig();
                await testFunctionStatus();
                
                // 3. SSMLç”Ÿæˆå’ŒéªŒè¯
                log('æ­¥éª¤ 3: SSML ç”Ÿæˆå’ŒéªŒè¯');
                generateSSML();
                validateSSML();
                
                // 4. TTSæµ‹è¯•
                log('æ­¥éª¤ 4: TTS è¯­éŸ³åˆæˆæµ‹è¯•');
                await testTTS();
                
                // 5. ç”Ÿæˆè¯Šæ–­æŠ¥å‘Š
                let report = 'ğŸ“‹ å®Œæ•´è¯Šæ–­æŠ¥å‘Š\n';
                report += '=' * 50 + '\n\n';
                
                report += `é…ç½®ä¿¡æ¯:\n`;
                report += `- Netlifyå‡½æ•°: ${config.netlifyEndpoint}\n`;
                report += `- é¢„æœŸRegion: ${config.region}\n\n`;
                
                report += 'è¯Šæ–­å»ºè®®:\n';
                report += '1. æ£€æŸ¥Netlifyç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®è®¾ç½®:\n';
                report += '   - AZURE_SPEECH_KEY\n';
                report += '   - AZURE_REGION\n\n';
                
                report += '2. ç¡®è®¤Azureç«¯ç‚¹é…ç½®:\n';
                report += '   - åœ¨speech.jsä¸­ä½¿ç”¨æ­£ç¡®çš„ç«¯ç‚¹æ ¼å¼\n';
                report += '   - æ£€æŸ¥åœ°åŒºè®¾ç½®æ˜¯å¦åŒ¹é…\n\n';
                
                report += 'è¯Šæ–­æ—¥å¿—:\n';
                diagnosticLogs.forEach(entry => {
                    const icon = entry.type === 'error' ? 'âŒ' : entry.type === 'success' ? 'âœ…' : 'â„¹ï¸';
                    report += `${icon} [${entry.timestamp}] ${entry.message}\n`;
                });
                
                showResult('diagnosticResult', report, 'info');
                log('å®Œæ•´è¯Šæ–­æµç¨‹å®Œæˆ');
                
            } catch (error) {
                showResult('diagnosticResult<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Azure TTS è¯Šæ–­æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }

        .test-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #3498db;
        }

        .test-section h3 {
            margin-top: 0;
            color: #2c3e50;
        }

        .form-group {
            margin: 15px 0;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #34495e;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            box-sizing: border-box;
        }

        button {
            background: #3498db;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 10px 10px 0;
            transition: background 0.3s ease;
        }

        button:hover {
            background: #2980b9;
        }

        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }

        .result {
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }

        .result.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .result.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .result.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .endpoint-test {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
            align-items: end;
        }

        .config-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 768px) {
            .config-grid {
                grid-template-columns: 1fr;
            }
            .endpoint-test {
                grid-template-columns: 1fr;
            }
        }

        .audio-controls {
            margin: 15px 0;
        }

        audio {
            width: 100%;
            margin: 10px 0;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-success { background: #28a745; }
        .status-error { background: #dc3545; }
        .status-warning { background: #ffc107; }
        .status-info { background: #17a2b8; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Azure TTS è¯Šæ–­æµ‹è¯•å·¥å…·</h1>
        
        <!-- é…ç½®éƒ¨åˆ† -->
        <div class="test-section">
            <h3>ğŸ“‹ Netlifyå‡½æ•°é…ç½®</h3>
            <div class="config-grid">
                <div class="form-group">
                    <label for="netlifyEndpoint">Netlifyå‡½æ•°ç«¯ç‚¹:</label>
                    <input type="text" id="netlifyEndpoint" value="/.netlify/functions/speech" placeholder="Netlifyå‡½æ•°è·¯å¾„">
                </div>
                <div class="form-group">
                    <label for="azureRegion">é¢„æœŸAzure Region:</label>
                    <select id="azureRegion">
                        <option value="eastasia">East Asia (eastasia)</option>
                        <option value="southeastasia">Southeast Asia</option>
                        <option value="eastus">East US</option>
                        <option value="westus">West US</option>
                        <option value="westeurope">West Europe</option>
                    </select>
                </div>
            </div>
            <p style="color: #666; font-size: 14px;">
                â„¹ï¸ æ­¤æµ‹è¯•é¡µé¢é€šè¿‡Netlifyå‡½æ•°è°ƒç”¨Azure TTSï¼Œå¯†é’¥å®‰å…¨å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ç¯å¢ƒå˜é‡ä¸­
            </p>
        </div>

        <!-- ç«¯ç‚¹æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸŒ Netlifyå‡½æ•°æµ‹è¯•</h3>
            <button onclick="testNetlifyFunction()">ğŸ”§ æµ‹è¯•Netlifyå‡½æ•°è¿æ¥</button>
            <button onclick="testNetlifyConfig()">âš™ï¸ æ£€æŸ¥å‡½æ•°é…ç½®</button>
            <button onclick="testFunctionStatus()">ğŸ“Š æ£€æŸ¥å‡½æ•°çŠ¶æ€</button>
            
            <div id="functionResult" class="result" style="display: none;"></div>
        </div>

        <!-- SSMLæµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ“ SSML æ ¼å¼æµ‹è¯•</h3>
            <div class="form-group">
                <label for="testText">æµ‹è¯•æ–‡æœ¬:</label>
                <input type="text" id="testText" value="ä½ å¥½ï¼æˆ‘ä¿‚æ–‡åŠ›æ–°ã€‚" placeholder="è¾“å…¥è¦è½¬æ¢çš„æ–‡æœ¬">
            </div>
            
            <div class="form-group">
                <label for="voiceName">å£°éŸ³é€‰æ‹©:</label>
                <select id="voiceName">
                    <option value="zh-HK-HiuMaanNeural">zh-HK-HiuMaanNeural (å¥³å£°)</option>
                    <option value="zh-HK-WanLungNeural">zh-HK-WanLungNeural (ç”·å£°)</option>
                    <option value="zh-HK-HiuGaaiNeural">zh-HK-HiuGaaiNeural (å¥³å£°å¹´è½»)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="ssmlOutput">ç”Ÿæˆçš„ SSML:</label>
                <textarea id="ssmlOutput" rows="6" readonly></textarea>
            </div>
            
            <button onclick="generateSSML()">ç”Ÿæˆ SSML</button>
            <button onclick="validateSSML()">éªŒè¯ SSML</button>
            <button onclick="testSimpleSSML()">æµ‹è¯•æœ€ç®€å•çš„ SSML</button>
        </div>

        <!-- TTSæµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸµ TTS è¯­éŸ³åˆæˆæµ‹è¯•</h3>
            <button onclick="testTTS()">ğŸ¯ æ‰§è¡Œå®Œæ•´ TTS æµ‹è¯•</button>
            <button onclick="testDifferentFormats()">ğŸ“Š æµ‹è¯•ä¸åŒéŸ³é¢‘æ ¼å¼</button>
            
            <div class="audio-controls">
                <audio id="audioPlayer" controls style="display: none;"></audio>
            </div>
            
            <div id="ttsResult" class="result" style="display: none;"></div>
        </div>

        <!-- ç»¼åˆè¯Šæ–­ -->
        <div class="test-section">
            <h3>ğŸ¥ ç»¼åˆè¯Šæ–­</h3>
            <button onclick="runFullDiagnostic()">ğŸš€ è¿è¡Œå®Œæ•´è¯Šæ–­</button>
            <button onclick="clearAllResults()">ğŸ§¹ æ¸…é™¤æ‰€æœ‰ç»“æœ</button>
            
            <div id="diagnosticResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentNetlifyEndpoint = '';
        let currentRegion = '';
        let diagnosticLogs = [];

        // æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            diagnosticLogs.push({timestamp, message, type});
            console.log(logEntry);
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(elementId, content, type = 'info') {
            const element = document.getElementById(elementId);
            element.className = `result ${type}`;
            element.textContent = content;
            element.style.display = 'block';
        }

        // è·å–å½“å‰é…ç½®
        function getCurrentConfig() {
            currentNetlifyEndpoint = document.getElementById('netlifyEndpoint').value.trim();
            currentRegion = document.getElementById('azureRegion').value;
            
            if (!currentNetlifyEndpoint) {
                throw new Error('è¯·è¾“å…¥ Netlify å‡½æ•°ç«¯ç‚¹');
            }
            
            return { 
                netlifyEndpoint: currentNetlifyEndpoint, 
                region: currentRegion 
            };
        }

        // ç”ŸæˆSSML
        function generateSSML() {
            const text = document.getElementById('testText').value.trim();
            const voice = document.getElementById('voiceName').value;
            
            if (!text) {
                showResult('ssmlOutput', 'è¯·è¾“å…¥æµ‹è¯•æ–‡æœ¬', 'error');
                return;
            }

            const ssml = `<speak version="1.0" xmlns="http://www.w3.org/2001/10/synthesis" xml:lang="zh-HK">
    <voice name="${voice}">
        ${text}
    </voice>
</speak>`;
            
            document.getElementById('ssmlOutput').value = ssml;
            log(`ç”Ÿæˆ SSML: ${voice} - ${text}`);
        }

        // éªŒè¯SSML
        function validateSSML() {
            const ssml = document.getElementById('ssmlOutput').value;
            
            if (!ssml) {
                showResult('ssmlOutput', 'è¯·å…ˆç”Ÿæˆ SSML', 'error');
                return;
            }

            try {
                const parser = new DOMParser();
                const doc = parser.parseFromString(ssml, 'text/xml');
                
                if (doc.documentElement.nodeName === 'parsererror') {
                    throw new Error('SSML XML æ ¼å¼é”™è¯¯');
                }
                
                // æ£€æŸ¥å¿…è¦å…ƒç´ 
                const speak = doc.querySelector('speak');
                const voice = doc.querySelector('voice');
                
                if (!speak) throw new Error('ç¼ºå°‘ <speak> å…ƒç´ ');
                if (!voice) throw new Error('ç¼ºå°‘ <voice> å…ƒç´ ');
                
                showResult('ssmlOutput', 'âœ… SSML æ ¼å¼éªŒè¯é€šè¿‡ï¼', 'success');
                log('SSML éªŒè¯æˆåŠŸ');
                
            } catch (error) {
                showResult('ssmlOutput', `âŒ SSML éªŒè¯å¤±è´¥: ${error.message}`, 'error');
                log(`SSML éªŒè¯å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•æœ€ç®€å•çš„SSML
        function testSimpleSSML() {
            const simpleSSML = `<speak version="1.0" xmlns="http://www.w3.org/2001/10/synthesis" xml:lang="zh-HK"><voice name="zh-HK-HiuMaanNeural">æ¸¬è©¦</voice></speak>`;
            document.getElementById('ssmlOutput').value = simpleSSML;
            log('åŠ è½½æœ€ç®€å•çš„ SSML æ ¼å¼');
        }

        // æµ‹è¯•Netlifyå‡½æ•°è¿æ¥
        async function testNetlifyFunction() {
            try {
                const config = getCurrentConfig();
                
                log(`æµ‹è¯• Netlify å‡½æ•°: ${config.netlifyEndpoint}`);
                
                // å‘é€ç®€å•çš„æµ‹è¯•è¯·æ±‚
                const testSSML = '<speak version="1.0" xmlns="http://www.w3.org/2001/10/synthesis" xml:lang="zh-HK"><voice name="zh-HK-HiuMaanNeural">æ¸¬è©¦</voice></speak>';
                
                const response = await fetch(config.netlifyEndpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ ssml: testSSML })
                });

                const result = `çŠ¶æ€ç : ${response.status}
Content-Type: ${response.headers.get('content-type')}
å‡½æ•°ç«¯ç‚¹: ${config.netlifyEndpoint}`;

                if (response.ok) {
                    const data = await response.json();
                    
                    showResult('functionResult', `âœ… Netlifyå‡½æ•°è¿æ¥æˆåŠŸï¼
${result}
å“åº”æ•°æ®: ${JSON.stringify(data, null, 2)}`, 'success');
                    log('Netlifyå‡½æ•°æµ‹è¯•æˆåŠŸ');
                    
                    // å¦‚æœæˆåŠŸä¸”æœ‰éŸ³é¢‘æ•°æ®ï¼Œå°è¯•æ’­æ”¾
                    if (data.audio) {
                        const audioBlob = new Blob(
                            [Uint8Array.from(atob(data.audio), c => c.charCodeAt(0))],
                            { type: 'audio/mpeg' }
                        );
                        const audioUrl = URL.createObjectURL(audioBlob);
                        const audioPlayer = document.getElementById('audioPlayer');
                        audioPlayer.src = audioUrl;
                        audioPlayer.style.display = 'block';
                    }
                    
                } else {
                    const errorText = await response.text();
                    let errorData;
                    
                    try {
                        errorData = JSON.parse(errorText);
                    } catch {
                        errorData = errorText;
                    }
                    
                    showResult('functionResult', `âŒ Netlifyå‡½æ•°è°ƒç”¨å¤±è´¥
${result}
é”™è¯¯ä¿¡æ¯: ${JSON.stringify(errorData, null, 2)}`, 'error');
                    log(`Netlifyå‡½æ•°å¤±è´¥: ${response.status}`, 'error');
                }

            } catch (error) {
                showResult('functionResult', `âŒ å‡½æ•°è¿æ¥é”™è¯¯: ${error.message}
å¯èƒ½çš„åŸå› :
1. Netlifyå‡½æ•°æœªéƒ¨ç½²
2. å‡½æ•°è·¯å¾„é”™è¯¯
3. ç½‘ç»œè¿æ¥é—®é¢˜
4. CORSé…ç½®é—®é¢˜`, 'error');
                log(`å‡½æ•°æµ‹è¯•é”™è¯¯: ${error.message}`, 'error');
            }
        }

        // æ£€æŸ¥Netlifyå‡½æ•°é…ç½®
        async function testNetlifyConfig() {
            try {
                const config = getCurrentConfig();
                
                log('æ£€æŸ¥ Netlify å‡½æ•°é…ç½®');
                
                // å°è¯• OPTIONS è¯·æ±‚æ£€æŸ¥ CORS
                const optionsResponse = await fetch(config.netlifyEndpoint, {
                    method: 'OPTIONS'
                });
                
                let configInfo = `å‡½æ•°ç«¯ç‚¹: ${config.netlifyEndpoint}\n`;
                configInfo += `OPTIONS å“åº”: ${optionsResponse.status}\n`;
                configInfo += `CORS å¤´éƒ¨:\n`;
                
                ['Access-Control-Allow-Origin', 'Access-Control-Allow-Methods', 'Access-Control-Allow-Headers'].forEach(header => {
                    const value = optionsResponse.headers.get(header);
                    configInfo += `  ${header}: ${value || 'æœªè®¾ç½®'}\n`;
                });
                
                // å°è¯• GET è¯·æ±‚çœ‹å‡½æ•°æ˜¯å¦å­˜åœ¨
                const getResponse = await fetch(config.netlifyEndpoint, {
                    method: 'GET'
                });
                
                configInfo += `\nGET è¯·æ±‚æµ‹è¯•: ${getResponse.status}\n`;
                
                if (getResponse.status === 405) {
                    configInfo += `âœ… å‡½æ•°å­˜åœ¨ï¼ˆ405 Method Not Allowed æ˜¯æ­£å¸¸çš„ï¼‰\n`;
                } else if (getResponse.status === 404) {
                    configInfo += `âŒ å‡½æ•°ä¸å­˜åœ¨æˆ–è·¯å¾„é”™è¯¯\n`;
                } else {
                    configInfo += `â„¹ï¸ æ„å¤–å“åº”çŠ¶æ€ï¼Œéœ€è¦è¿›ä¸€æ­¥æ£€æŸ¥\n`;
                }
                
                showResult('functionResult', configInfo, 'info');
                log('å‡½æ•°é…ç½®æ£€æŸ¥å®Œæˆ');
                
            } catch (error) {
                showResult('functionResult', `âŒ é…ç½®æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
                log(`é…ç½®æ£€æŸ¥é”™è¯¯: ${error.message}`, 'error');
            }
        }

        // æ£€æŸ¥å‡½æ•°çŠ¶æ€
        async function testFunctionStatus() {
            try {
                const config = getCurrentConfig();
                
                log('æ£€æŸ¥å‡½æ•°çŠ¶æ€å’Œç¯å¢ƒå˜é‡');
                
                // å‘é€ç©ºè¯·æ±‚æµ‹è¯•å‡½æ•°å“åº”
                const response = await fetch(config.netlifyEndpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({}) // ç©ºè¯·æ±‚ä½“
                });
                
                const responseText = await response.text();
                let responseData;
                
                try {
                    responseData = JSON.parse(responseText);
                } catch {
                    responseData = responseText;
                }
                
                let statusInfo = `å‡½æ•°çŠ¶æ€æ£€æŸ¥:\n`;
                statusInfo += `çŠ¶æ€ç : ${response.status}\n`;
                statusInfo += `å“åº”: ${JSON.stringify(responseData, null, 2)}\n\n`;
                
                // åˆ†æå“åº”åˆ¤æ–­é—®é¢˜
                if (response.status === 400) {
                    if (responseData.error && responseData.error.includes('SSML')) {
                        statusInfo += `âœ… å‡½æ•°æ­£å¸¸å·¥ä½œï¼Œç­‰å¾…æœ‰æ•ˆçš„SSMLè¾“å…¥\n`;
                    } else if (responseData.error && responseData.error.includes('Azure')) {
                        statusInfo += `âš ï¸ Azureé…ç½®é—®é¢˜: ${responseData.error}\n`;
                    } else {
                        statusInfo += `â„¹ï¸ å‡½æ•°å“åº”400ï¼Œå¯èƒ½æ˜¯è¾“å…¥éªŒè¯\n`;
                    }
                } else if (response.status === 500) {
                    statusInfo += `âŒ æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œå¯èƒ½æ˜¯ç¯å¢ƒå˜é‡æˆ–Azureé…ç½®é—®é¢˜\n`;
                } else {
                    statusInfo += `â„¹ï¸ çŠ¶æ€ç  ${response.status}ï¼Œéœ€è¦è¿›ä¸€æ­¥åˆ†æ\n`;
                }
                
                showResult('functionResult', statusInfo, 'info');
                log('å‡½æ•°çŠ¶æ€æ£€æŸ¥å®Œæˆ');
                
            } catch (error) {
                showResult('functionResult', `âŒ çŠ¶æ€æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
                log(`çŠ¶æ€æ£€æŸ¥é”™è¯¯: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•TTS
        async function testTTS() {
            try {
                generateSSML(); // å…ˆç”ŸæˆSSML
                validateSSML(); // éªŒè¯SSML
                
                const config = getCurrentConfig();
                const ssml = document.getElementById('ssmlOutput').value;
                
                if (!ssml) {
                    throw new Error('è¯·å…ˆç”Ÿæˆ SSML');
                }

                log('å¼€å§‹é€šè¿‡Netlifyå‡½æ•°è¿›è¡ŒTTSæµ‹è¯•');
                showResult('ttsResult', 'æ­£åœ¨é€šè¿‡Netlifyå‡½æ•°è¿›è¡ŒTTSæµ‹è¯•...', 'info');

                const response = await fetch(config.netlifyEndpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ ssml: ssml })
                });

                if (response.ok) {
                    const data = await response.json();
                    
                    if (data.audio) {
                        // è§£ç å¹¶æ’­æ”¾éŸ³é¢‘
                        const audioBlob = new Blob(
                            [Uint8Array.from(atob(data.audio), c => c.charCodeAt(0))],
                            { type: 'audio/mpeg' }
                        );
                        const audioUrl = URL.createObjectURL(audioBlob);
                        const audioPlayer = document.getElementById('audioPlayer');
                        
                        audioPlayer.src = audioUrl;
                        audioPlayer.style.display = 'block';
                        
                        showResult('ttsResult', `âœ… TTS æµ‹è¯•æˆåŠŸï¼
çŠ¶æ€ç : ${response.status}
éŸ³é¢‘å¤§å°: ${data.size || audioBlob.size} bytes
éŸ³é¢‘ç±»å‹: ${data.contentType || audioBlob.type}

ğŸµ éŸ³é¢‘å·²ç”Ÿæˆï¼Œç‚¹å‡»æ’­æ”¾å™¨è¯•å¬`, 'success');
                        
                        log('TTS æµ‹è¯•æˆåŠŸ');
                    } else {
                        showResult('ttsResult', `âš ï¸ å‡½æ•°å“åº”æˆåŠŸä½†æ²¡æœ‰éŸ³é¢‘æ•°æ®
å“åº”: ${JSON.stringify(data, null, 2)}`, 'error');
                    }
                    
                } else {
                    const errorData = await response.json();
                    showResult('ttsResult', `âŒ TTS æµ‹è¯•å¤±è´¥
çŠ¶æ€ç : ${response.status}
é”™è¯¯ä¿¡æ¯: ${JSON.stringify(errorData, null, 2)}

å¯èƒ½çš„é—®é¢˜:
1. Azureå¯†é’¥æœªé…ç½®æˆ–æ— æ•ˆ
2. Azureç«¯ç‚¹é…ç½®é”™è¯¯
3. SSMLæ ¼å¼é—®é¢˜
4. AzureæœåŠ¡é…é¢é—®é¢˜`, 'error');
                    
                    log(`TTS æµ‹è¯•å¤±è´¥: ${response.status}`, 'error');
                }

            } catch (error) {
                showResult('ttsResult', `âŒ TTS æµ‹è¯•é”™è¯¯: ${error.message}`, 'error');
                log(`TTS æµ‹è¯•é”™è¯¯: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•ä¸åŒéŸ³é¢‘æ ¼å¼
        async function testDifferentFormats() {
            const config = getCurrentConfig();
            
            // è¿™ä¸ªéœ€è¦ä¿®æ”¹Netlifyå‡½æ•°æ¥æ”¯æŒä¸åŒæ ¼å¼
            // æš‚æ—¶ä½¿ç”¨æ ‡å‡†æ ¼å¼æµ‹è¯•
            const testCases = [
                { voice: 'zh-HK-HiuMaanNeural', text: 'å¥³è²æ¸¬è©¦' },
                { voice: 'zh-HK-WanLungNeural', text: 'ç”·è²æ¸¬è©¦' },
                { voice: 'zh-HK-HiuGaaiNeural', text: 'å¹´è¼•å¥³è²æ¸¬è©¦' }
            ];

            let results = 'æµ‹è¯•ä¸åŒå£°éŸ³:\n\n';

            for (const testCase of testCases) {
                try {
                    const ssml = `<speak version="1.0" xmlns="http://www.w3.org/2001/10/synthesis" xml:lang="zh-HK"><voice name="${testCase.voice}">${testCase.text}</voice></speak>`;
                    
                    const response = await fetch(config.netlifyEndpoint, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ ssml: ssml })
                    });

                    results += `å£°éŸ³: ${testCase.voice}\n`;
                    results += `çŠ¶æ€: ${response.status}\n`;
                    
                    if (response.ok) {
                        const data = await response.json();
                        results += `âœ… æˆåŠŸ - å¤§å°: ${data.size} bytes\n`;
                    } else {
                        const errorData = await response.json();
                        results += `âŒ å¤±è´¥: ${errorData.error}\n`;
                    }
                    
                } catch (error) {
                    results += `å£°éŸ³: ${testCase.voice}\nâŒ é”™è¯¯: ${error.message}\n`;
                }
                
                results += '\n';
            }

            showResult('ttsResult', results, 'info');
        }

        // è¿è¡Œå®Œæ•´è¯Šæ–­
        async function runFullDiagnostic() {
            diagnosticLogs = [];
            log('å¼€å§‹å®Œæ•´è¯Šæ–­æµç¨‹');
            
            showResult('diagnosticResult', 'ğŸš€ æ­£åœ¨è¿è¡Œå®Œæ•´è¯Šæ–­...\nè¯·ç¨ç­‰...', 'info');

            try {
                // 1. é…ç½®æ£€æŸ¥
                log('æ­¥éª¤ 1: æ£€æŸ¥é…ç½®');
                const config = getCurrentConfig();
                
                // 2. Netlifyå‡½æ•°æµ‹è¯•
                log('æ­¥éª¤ 2: æµ‹è¯•Netlifyå‡½æ•°');
                await testNetlifyConfig();
                await testFunctionStatus();
                
                // 3. SSMLç”Ÿæˆå’ŒéªŒè¯
                log('æ­¥éª¤ 3: SSML ç”Ÿæˆå’ŒéªŒè¯');
                generateSSML();
                validateSSML();
                
                // 4. TTSæµ‹è¯•
                log('æ­¥éª¤ 4: TTS è¯­éŸ³åˆæˆæµ‹è¯•');
                await testTTS();
                
                // 5. ç”Ÿæˆè¯Šæ–­æŠ¥å‘Š
                let report = 'ğŸ“‹ å®Œæ•´è¯Šæ–­æŠ¥å‘Š\n';
                report += '='.repeat(50) + '\n\n';
                
                report += `é…ç½®ä¿¡æ¯:\n`;
                report += `- Netlifyå‡½æ•°: ${config.netlifyEndpoint}\n`;
                report += `- é¢„æœŸRegion: ${config.region}\n\n`;
                
                report += 'è¯Šæ–­å»ºè®®:\n';
                report += '1. æ£€æŸ¥Netlifyç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®è®¾ç½®:\n';
                report += '   - AZURE_SPEECH_KEY\n';
                report += '   - AZURE_REGION\n\n';
                
                report += '2. ç¡®è®¤Azureç«¯ç‚¹é…ç½®:\n';
                report += '   - åœ¨speech.jsä¸­ä½¿ç”¨æ­£ç¡®çš„ç«¯ç‚¹æ ¼å¼\n';
                report += '   - æ£€æŸ¥åœ°åŒºè®¾ç½®æ˜¯å¦åŒ¹é…\n\n';
                
                report += '3. å¸¸è§é—®é¢˜æ’æŸ¥:\n';
                report += '   - å¦‚æœæ˜¾ç¤º404: å‡½æ•°æœªéƒ¨ç½²æˆ–è·¯å¾„é”™è¯¯\n';
                report += '   - å¦‚æœæ˜¾ç¤º400: Azureé…ç½®æˆ–SSMLæ ¼å¼é—®é¢˜\n';
                report += '   - å¦‚æœæ˜¾ç¤º500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œæ£€æŸ¥ç¯å¢ƒå˜é‡\n\n';
                
                report += 'è¯Šæ–­æ—¥å¿—:\n';
                diagnosticLogs.forEach(entry => {
                    const icon = entry.type === 'error' ? 'âŒ' : entry.type === 'success' ? 'âœ…' : 'â„¹ï¸';
                    report += `${icon} [${entry.timestamp}] ${entry.message}\n`;
                });
                
                showResult('diagnosticResult', report, 'info');
                log('å®Œæ•´è¯Šæ–­æµç¨‹å®Œæˆ');
                
            } catch (error) {
                showResult('diagnosticResult', `âŒ è¯Šæ–­è¿‡ç¨‹ä¸­å‡ºé”™: ${error.message}`, 'error');
                log(`è¯Šæ–­é”™è¯¯: ${error.message}`, 'error');
            }
        }

        // æ¸…é™¤æ‰€æœ‰ç»“æœ
        function clearAllResults() {
            const results = ['functionResult', 'ttsResult', 'diagnosticResult'];
            results.forEach(id => {
                const element = document.getElementById(id);
                element.style.display = 'none';
            });
            
            document.getElementById('audioPlayer').style.display = 'none';
            diagnosticLogs = [];
            log('æ¸…é™¤æ‰€æœ‰æµ‹è¯•ç»“æœ');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨ç”ŸæˆSSML
        window.onload = function() {
            generateSSML();
            log('æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
        };
    </script>
</body>
</html>